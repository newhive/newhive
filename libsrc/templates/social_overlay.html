{<with expr}
  <div id="popup_content">
    <div class="left_pane">
      {# expression title #}
      <div class="title_spacer">
        <div class="title expr text">{expr.title}</div></div>
      {# user profile #}
      {<with owner "brief" true}
        {|templates/profile_card.html}
      {>}
    </div>
    <div class="right_pane">
      {# tags #}
      <div class="vcenter_spacer"><div class="spacer">
        {<with null "more_menu" true}
          {|templates/tag_list.html}
        {>}
      </div></div>
      {# Action icons #}
      <div class="stats_bar">
        {# views, metadata #}
        {<with null "attr_id" "views_icon" "icon_class" "views" "count" counts.Views}
          {|templates/icon_count.html}
        {>}
        {# Views menu drawer #}
        <div id="views_menu" class="menu drawer" data-handle='#views_icon' >
          <div class='menu_item'>
            <div class="text upper item">Created</div>
            <div>{recency_time created}</div>
          </div>
          <div class='menu_item'>
            <div class="text upper item">Updated</div>
            <div>{recency_time updated}</div>
          </div>
        </div>
        {# Love icon + drawer #}
        {<with null "attr_id" "love_icon" "icon_class" "love" "count" counts.Star}
          {|templates/icon_count.html}
        {>}
        {# Loves menu drawer #}
        <div id="loves_menu" class="menu drawer icon_set" data-handle='#love_icon' >
          {<with null "activity" expr.loves "icon_only" true}
            {|templates/activity.html}
          {>}
        </div>
        {# Broadcast icon + drawer #}
        {<with null "attr_id" "broadcast_icon" "icon_class" "republish" "count" counts.Broadcast}
          {|templates/icon_count.html}
        {>}
        {# Broadcast menu drawer #}
        <div id="broadcast_menu" class="menu drawer icon_set" data-handle='#broadcast_icon' >
          {<with null "activity" expr.broadcast "icon_only" true}
            {|templates/activity.html}
          {>}
        </div>
        {# TODO: add share icons back in
            {>}{<with null "icon_class" "facebook"}
              {|templates/icon_count.html}
            {>}{<with null "icon_class" "tweet"}
              {|templates/icon_count.html}
        #}
        {# Comment #}
        {<with null "attr_id" "comment_icon" "icon_class" "comment" "count" counts.Comment}
          {|templates/icon_count.html}
        {>}
        {# Share #}
        {<with null "attr_id" "social_share_icon" "icon_class" "share narrow"}
          {|templates/icon_count.html}
        {>}
        {# home button (moved to top nav)
            <a { anchor_attrs "home" }>
              {<with null "icon_class" "logo narrow"}{|templates/icon_count.html}{>}
            </a> 
        #}
        {# Overlay close button #}
        {<with null "attr_id" "social_close" "icon_class" "plus-minus narrow"}
          {|templates/icon_count.html}
        {>}

        {# Star/unstar form #}
        <form class="love" {form_attrs "star_unstar"} method='post'>
          <input type="hidden" name="entity" value="{id}">
          <input type="hidden" name="state" value="true">
        </form>
        <form class="republish" {form_attrs "broadcast"} method='post'>
          <input type="hidden" name="entity" value="{id}">
          <input type="hidden" name="state" value="true">
        </form>
        {# Comments menu drawer #}
        <div id="comments_menu" class="menu drawer icon_set" data-handle='#comment_icon' >
          {<with null "activity" comments "icon_only" true}
            {|templates/activity.html}
          {>}
        </div>
        {# Share menu drawer #}
        <div id="share_menu" class="menu drawer" data-handle='#social_share_icon'>
          <div class='menu_item black_active'>
            <a {href_attrs "expr_snapshot" "expr_id" id} id='save_jpg_btn'>Save as JPG
              {# TODO: this saves as png, need to process into jpg #}
            </a></div>
          <div id='embed_form_btn' class='text_btn menu_item item text hoverable black_active'
              ><span class='text'>Embed Expression</span></div>
          <div id='share_form_btn' class='text_btn menu_item item text hoverable black_active'
              ><span class='text'>Share Expression</span></div>
        </div>
        {# belongs in its own file? #}
        <div id="dia_comments" class="dialog" data-handle='#comment_icon'>
          {# activity feed #}
          <div class="title text">Discussion</div>
          {<with null "icon_class" "comment nohover discussions" "count" counts.Comment} {|templates/icon_count.html}{>}
          <div>TODO: Dialog to spec (Move enter button, add horizontal separators, change format to include wrench/x hover and comment age)</div>
          <div class='activity'>{<for comments}
            {|templates/comment.html}
          {>}</div>
          {# discussion input #}
          <div id="discussions">
           <form {form_attrs "comment_create"} id='comment_form' action='/api/comment/create' method='POST'>
              <div class="textarea_padder"><textarea name='text' placeholder=
                {<if user.logged_in}'Join the conversation.'
                {>}{<else}'Log in to comment...' disabled
                {>} rows='4'></textarea></div>
              <div class="rightify">{<if user.logged_in}<input type='submit' value='Enter' class='submit upper btn black rounded'>{>}</div>
              <input type='hidden' name='action' value='comment'>
              <input type='hidden' name='entity' value='{id}'>
            </form>
          </div>  
        </div>
        {|templates/dialog_embed.html}
        {|templates/dialog_share.html}
      </div>
   
    </div>
  </div>
{>}
