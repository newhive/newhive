{set "clean_options" (string_to_list query.clean)}
{# TODO: create default for clean_options here. right now it is set it in dialog_embed.html #}

{# TODO: un-flag this after ship #}
{<if flags.new_nav}
<div class="main-header">
  <div class= "_2column">
    {# LEFT content. #}
    <div class="left fixed inline centered">
      {# LOGGED OUT: #}
      {<if (not user.logged_in)}
        <a {anchor_attrs "home"}
          ><img class="logo splash" src='{asset "skin/site/logo_text.png"}' 
          title="Newhive Logo"></a>
      {>}{<else}
        {# Main navigation #}
        <div class='network_nav inline'>
          <a { anchor_attrs "expressions_public" "owner_name" user.name }>
            <div class='text_btn item teal_hover username ellipsis
            {<if route.profile} black_btn{>}'>{user.name}</div></a>
          <a { anchor_attrs "home"}>
            <div class='text_btn item teal_hover featured home_cat'>The Hive</div></a>
          <a { anchor_attrs "network"}>
            <div class='text_btn item teal_hover network'>Network</div></a>
          {<if flags.show_hive_all}
            <a { anchor_attrs "recent"}>
              <div class='text_btn item teal_hover recent'>All</div></a>
          {>}
        </div>

      {>}
    </div>

    {# RIGHT content. #}
    <div class="right fixed inline centered">
        {<if (not user.logged_in)}
          <div class="hide_condensed blurb upper">Art is a drug<br></div>
        {>}

        {<if (not user.logged_in)}
          {# Main navigation #}
          <div class='network_nav inline'>
            {# empty <a> for css #}
            <a><div class='login_btn text_btn item teal_hover'>Log in</div></a>
            <a {anchor_attrs "signup"}>
              <div class='text_btn item teal_hover'>Sign Up</div></a>
            <a {anchor_attrs "view_expr"
              "owner_name" config.site_user "expr_name" "about"}>
              <div class='login_btn text_btn item teal_hover'>About</div></a>
          </div>
        {>}
        {# Search bar #}
        <form class="search_bar"
          method='GET' action='/search' name='search_form'>
            <input type="text" id="search_box" placeholder="Search"
            class="inline{<if (not user.logged_in)} focus_expanded{>}"
              name='q' value='{query.q}'
            ><input type="submit" value disabled class='hoverable icon go_search inline'
          ></form
        >
        {# Create new page #}
        <a {anchor_attrs "create_expr"} title='Create newhive'
          class='needs_login create item btn hoverable'></a>
    </div>
  </div>
  <div class="header">
  </div>
</div>
{>}

<div class='overlay bottom panel nav
  {<if (and query.clean (not (contains clean_options "social")))} stay_hidden{>}'>
  {# create or signup/login #}
  {<unless user.logged_in}
    <span class='signup'>
      {<if flags.open_signup}
        <a {anchor_attrs "signup"} class='signup_btn text_btn btn menu_item'
          >Sign Up</a>
      {>}{<else}
        <span class='signup_btn text_btn btn menu_item'>Sign Up</span>
      {>}
      <span class='red_spacer'></span>
      <span class='login_btn text_btn left_border btn menu_item'>Log in</span>
    </span>
  {>}
  {# expression specific #}
  <span class='expr_actions'></span>{# no \n #}
  <span class='hide edit_ui'></span>{# no \n #}
  <a {anchor_attrs "create_expr"} title='Create newhive'
    class='needs_login create item btn hoverable'></a>
  {# + button to open overlay #}
  <div class='social_btn item btn hide hoverable'></div>
</div>
{<if (not flags.mobile)}
  <div class='social overlay left page_btn page_prev
    {<if (and query.clean (not (contains clean_options "collection")))} stay_hidden{>}'></div>
  <div class='social overlay right page_btn page_next
     {<if (and query.clean (not (contains clean_options "collection")))} stay_hidden{>}'></div>
{>}

{# hive logo button #}
{<with null "standalone" true}{|templates/hive_menu.html}{>}

{# menu: logo #}
<div id='logo_menu' class='menu drawer {<if (eq query.template "embed")} stay_hidden{>}' data-handle='.hive_logo'>
  {<if user.logged_in}
    <form {form_attrs "logout"} method='POST' id='logout_form'></form>
    <div id='logout_btn' class='menu_item'>Logout</div>
    <a {anchor_attrs "view_expr"
      "owner_name" config.site_user "expr_name" "about"}
      class='menu_item'>About</a>
    {# <div id='invite_btn' class='menu_item'>Invites</div> #}
    <div id='activity_btn' class='menu_item hoverable'>
        <div class='icon'></div>
        <div class='count'>0</div>
        Activity
    </div>
    <a id='user_btn' { anchor_attrs "expressions_public" "owner_name" user.name }
      class='menu_item hoverable'>{user.name|e}</a>
    <a {anchor_attrs "home"} class='menu_item default hoverable'>Network</a>
  {>}{<else}
    <a {anchor_attrs "signup"} class='menu_item'>Sign Up</a>
    <div class='login_btn menu_item'>Log in</div>
    <a {anchor_attrs "view_expr"
      "owner_name" config.site_user "expr_name" "about"}
      class='menu_item'>About NewHive</a>
    <a {anchor_attrs "home"} class='menu_item default'>The Hive</a>
  {>}
</div>

{# User community actions #}
{<if user.logged_in}
  <div id='activity_menu' class='menu drawer user_menu activity items'
    data-handle='#activity_btn' data-parent='#logo'
  >{|templates/user_activity.html}</div>
  <form id='notification_reset' {form_attrs "notification_reset"}></form>
  <form id='activity_form' {form_attrs "activity"}></form>
{>}{<else}
  <div id='dia_login' class='dialog login' data-handle='.login_btn'>
    {#<a href="{facebook_authentication_url}" target="_top"
      <img src='{"skin/1/fb_sign_in.png"|asset_url}' style='margin: 20px 0 2px -4px;'>
    </a>#}
    <div class="title">Log in:</div>
    {|templates/login_form.html}
  </div>
{>}

{# Password recovery #}
<div id="dia_recover" class="standard dialog" data-handle='.password_recovery'>
  <div class="title expr">Reset your password:</div>
  <div class="subheading error_msg"></div>
  {<vcenter "success_show heading pointer"}
    <div class="centered">A password reset link was sent to your email.</div>
  {>}
  <div class="success_hide">
    <form { form_attrs "password_recover" } id='form_password_recover' method='POST'>
      <div class="form_text">Enter your email address.</div>
      <input autofocus placeholder="Email" type="text" name="email">
      <button type="submit" class="submit teal_btn upper">Enter</button>
    </form>
  </div>
</div>

{# social overlay popup on expressions #}
<div class='social overlay' id='social_overlay'></div>
