{% extends "main.html" %}
{% block body_classes %}{{ super() }} expr_cards{% endblock %}

{% block head %}
 {{ super() }}
<script>
  $(function(){
    {% if user_is_owner %}
      var hoverin = function(){ $('#profile_thumb').append('<div class="message">Change Picture</div>'); };
      var hoverout = function(){ $('#profile_thumb .message').remove(); };
      $('#profile_thumb img').hover(hoverin, hoverout);
    {% endif %}

    $('#profile_thumb_file_input').change(function() {
      $('#profile_thumb_upload_form input[name="forward"]').val(window.location);
      $('#profile_thumb_upload_form').submit();
    });
  });

  var profile_thumb_choose = function(){
    $('#profile_thumb_file_input').click();
    return false;
  };
</script>
{% endblock %}

{% block nav %}
  {{ super() }}
  
  <div class='nav' style='right : {{ '10' if user.logged_in else '197' }}px; top : 0px;'>
   <div class='nav_icon text hoverable medbold' onclick="" title="Help with your profile" style='margin-right : 8px;' id='btn_help'>?</div>
   <script>
    (function() { var b = $('#btn_help');
      b.click(function() { exprDialog('{{ site_pages['profile-help'] }}', { minimize_to : b } ) });
      {% if show_help %}$('#btn_help').click(){% endif %} })();
   </script>
   <img id='btn_share' src='/lib/skin/1/share.png' class='hoverable nav_icon' title='share'>
   {{ star_button(owner.star_count, owner.id in user.starred_item_ids, user.logged_in, title={"active": "Stop Listening", "inactive": "Listen to " + owner.fullname}, user_is_owner=(owner.id == user.id))}}
   {% if user.logged_in %}
   {{ create_button(create) }}
   {% endif %}
   {% set collection = {'data': starrers, 'type': 'listeners', 'id': 'starrers'} %}
   {% include "dialogs/starrers.html" %}
  </div>
  
{% endblock nav %}

{% block header %}
    <div id='profile_thumb'>
      {% if user_is_owner %}
        <a href="#" onclick="profile_thumb_choose();" alt="Choose Picture">
      {% endif %}
      {% if profile_thumb %}
        <img src='{{ profile_thumb }}' alt="{{ owner.fullname }}"/>
      {% elif user_is_owner %}
        <div class='placeholder rounded'>Click Here to<br/>Upload A Profile Image</div>
      {% endif %}
      {% if user_is_owner %}
        </a>
        <form id='profile_thumb_upload_form' method='POST' enctype='multipart/form-data' action='{{ secure_server }}' style='position : absolute; left : -1000px'>
          <input name='profile_thumb' id='profile_thumb_file_input' type='file'>
          <input type='hidden' name='action' value='profile_thumb_set'>
          <input type='hidden' name='forward' value=''>
          <iframe id='profile_thumb_upload_target' name='profile_thumb_upload_target' style='position : absolute; left : -1000px'></iframe>
        </form>
      {% endif %}
    </div>
    <h1 class="index">
      {% if owner.has_homepage %}<a href='/'>{% endif %}{{ owner.fullname }}{% if owner.has_homepage %}</a>{% endif %}{{ ': ' + tag.name if tag and tag.show_name != False }}
    </h1>

{% endblock header %}
 
{% block left_column %}
  {% include "page_parts/tags.html" %}
{% endblock left_column %}

{% block right_column %}
  <div id='feed'>
    {% if feed_items %}
    {% for feed in feed_items | reverse %}
      {% include 'partials/feed.html' %}
    {% endfor %}
    {% else %}
      {% include 'page_parts/cards.html' %}
    {% endif %}
  </div>
{% endblock right_column %}

{% block footer_scripts %}
  {{ super () }}
  <script>
    $(function(){ 
      fix_borders('#feed .item');
      $(window).resize(function(){fix_borders('#feed .item');});
    });
  </script>
{% endblock %}
