{% extends "page.html" %}

{% block meta %}
  <meta id='viewport' name='viewport'>
{% endblock meta %}
{% block head %}
  <style>
body, html, #exprs { height:100%; margin:0; }
body { overflow:hidden; }
iframe { border:none; width:100%; height:100% }
.hide { display:none; }
.icon { display:inline-block; background-size:100%; }
.hinv:hover, #preview:hover .hinv {
  filter:invert(100%); -webkit-filter:invert(100%); }
.center { margin:auto; left:0;top:0;right:0;bottom:0; }

.snapshot { width:100%; position:fixed; }
#play { position:fixed; width:30%; height:30%; margin:auto;
  top:0;right:0;bottom:0;left:0; opacity:.85; }

.bbar { position:fixed; bottom:0; height:60px; width:100%; }
#bbar { transition-property:opacity; transition-duration:1s; opacity:0; }
#bbar:hover, #bbar.shaded { opacity: 1; }
#bbar .shader { background-color:#fff; opacity:.85; }
#bbar .icon { height:60px; width:60px; }
#bbar .right { position:absolute; display:inline-block;
  right:0;top:0; height:100%; }
  /*background-image:url('{{ "skin/nav/logo.png"|asset_url }}'); }*/
#bbar .logo:hover { background-color:black; }
#bbar .logo:hover path { fill:white; }
#bbar .hinv:hover { background-color:white; }
/*{#
#share { position:absolute; width:525px; height:175px; }
#share .icon { width:138px; height:138px; border-radius:69px;
  background-color:black; margin:18px; }
#share .icon img { width:92px; padding:23px; }
#share .link { position:absolute; right:0; bottom:0; width:200px;
  font-size:large; }
#}*/
  </style>
{% endblock head %}
{% block body %}
  <div id='overlays'>
    <div class='bbar{% if not query.autoplay %} hide{% endif %}' id='bbar'>
      <div class='bbar shader' id='shader'></div>
      <div class='bbar'>
        <a href='{{ expr.url }}' class='icon logo' target='_new'>{%
          include 'lib/skin/nav/logo.svg' %}</a>
        <div class='right'
          {#><img class='icon hinv' id='share_btn'
            src='{{ "skin/nav/share.png"|asset_url }}'#}
          ><img class='icon hinv' id='full'
            src='{{ "skin/nav/fullscreen.png"|asset_url }}'
          ><img class='icon' id='owner'
            src='{{ expr.owner.get_thumb(190) }}'
          >{% include 'lib/skin/nav/pause.svg' %}
        ></div>
      </div> 
    </div>
    <div id='site'></div>
    {#
    <div id='share' class='hide center'
      ><a href='https://twitter.com/share?url={{ expr.url }}&related=NewHive&text={{ ("\""+expr.title+"\" by "+expr.owner.fullname)|e }}' target='_new' title='Share on twitter'><div class='icon hinv'><img src='{{ "skin/nav/twitter.svg"|asset_url }}'></div></a
      ><a href='https://www.facebook.com/sharer/sharer.php?u={{ expr.url|e }}'target='_new' title='Share on facebook'><div class='icon hinv'><img src='{{ "skin/nav/fb-f.svg"|asset_url }}'></div></a
      ><div class='icon hinv' id='link_btn' title='Copy link'
        ><img src='{{ "skin/nav/link.svg"|asset_url }}'
        ><input readonly type='text' value='{{ expr.url }}' id='link'
          class='link hide'
      ></div
    ></div>
    #}
  </div>

  <div id='exprs'>
    <iframe id='expr_{{ expr.id }}' data-src='{{ content_url }}'
      {% if query.autoplay %}
        src='{{ content_url }}'
        class='expr hide'
      {% else %}
        class='expr'
      {% endif %}
      allowfullscreen></iframe>
    <div id='preview' class='{% if query.autoplay %}hide{% endif %}'>
      <img src='{{ expr.snapshot_name('big') }}' class='snapshot center'>
      <img id='play' class='hinv' src='{{ "skin/nav/newhive-play.svg"|asset_url }}'>
    </div>
  </div>
  <script>

var play_btn = document.getElementById('play')
   ,preview = document.getElementById('preview')
   ,bbar = document.getElementById('bbar')
   ,pause = document.getElementById('pause')
   ,full = document.getElementById('full')
   // ,share = document.getElementById('share')
   ,link = document.getElementById('link')
   ,link_btn = document.getElementById('link_btn')
   ,f = document.getElementById('expr_' + {{ expr.id|json }})

preview.onclick = function(){
    preview.classList.add('hide')
    f.setAttribute('src', f.getAttribute('data-src'))
    f.classList.remove('hide')
    bbar.classList.remove('hide')
    bbar.classList.add('shaded')
    setTimeout(function(){ bbar.classList.remove('shaded') }, 500)
}
pause.onclick = function(){
    f.classList.add('hide')
    preview.classList.remove('hide')
    f.setAttribute('src', '')
    bbar.classList.add('hide')
}

full.onclick = function(){
    (f.webkitRequestFullscreen || f.mozRequestFullScreen || f.requestFullscreen
      ).call(f)
}

{#
document.getElementById('share_btn').onclick = function(){
    share.classList.remove('hide') }
onmessage = function(){ share.classList.add('hide') }
link_btn.onmouseover = function(){
    link.classList.remove('hide')
    link.focus()
    link.select()
}
link_btn.onmouseout = function(){
    link.classList.add('hide')
}
#}
  </script>
{% endblock body %}
