{% extends "main.html" %}

{% block head %}
 <style>
  .happ { position : absolute; }
  .happ img { width : 100%; }
  #info { display : inline-block; text-align : right; margin-right : 10px; vertical-align : top; }
  #exp_owner { background-color : {{ colors['selected'] }}; margin : 5px 0 5px; padding : 1px 5px; display : inline-block; }
  #datetime { font-size : .7em; color : {{ colors[12] }}; line-height : .5em; }
  #feed { position : absolute; bottom : 0; left : 0; width : 100%; border : none; height : 100px; }
  {{ css }}
 </style>
 <meta id="og_title" class="og_title" property="og:title" content='{{ title }}'>
 <meta id="og_image" class="og_image" property="og:image" content='{{ exp.thumb|default('/lib/skin/1/default_thumb.png') }}'>
 <meta id="og_url" class="og_url"     property="og:url" content='{{ secure_server }}'>
 <!--
 <meta id="og_desc" class="og_desc"   property="og:description" content='blahblah'>
 <meta id="fb_admin" class="fb_admin" property="fb:admins" content=__optional, a facebook user id__/>
 -->
 <meta property="og:type" content="website" />
 <meta property="og:site_name" content='The New Hive'>
{% endblock %}

{% block body %}
 <div class='nav' style='right : {{ '10' if user.logged_in else '97' }}px; top : 0px;'>
  {% if not user_is_owner %}
   <div id='info' class='medbold' style='text-align : right'>
    <div id='exp_owner'><a href='{{ owner_url }}'>{{ owner['name'] }}</a></div>
    <div id='datetime'><nobr>{{ mtime }}</nobr></div>
   </div>
  {% endif %}

  <img id='btn_share' src='/lib/skin/1/share.png' class='hoverable nav_icon' title='share'>
  <script>
    $('#expression_url').html(window.location.href);
    //share_menu = click_dialogue($('#btn_share'), $('#dia_share'));
  </script>
 
  {% if user.logged_in %}
   <a href='{{ create }}'><img src='/lib/skin/1/create.png' class='hoverable nav_icon' title='create'></a>
  {% endif %}
 
 {% if user_is_owner %}
   <a href='{{ edit }}'><img id='btn_edit' src='/lib/skin/1/edit.png' class='hoverable nav_icon' title='edit'></a>
   <img id='btn_delete' src='/lib/skin/1/delete_page.png' class='hoverable nav_icon' title='delete'>
   <div id='dia_delete' class='menu medbold' style='padding : 10px; width : 13em;'>
    Are you sure you want
    to delete this page?
    <br>
    <form method='POST' action='{{ secure_server }}'>
     <input type='hidden' name='action' value='expr_delete'>
     <input type='hidden' name='id' value='{{ exp.id }}'>
     <div style='text-align : right'><input type='submit' value='Yes' class='btn black rounded medbold'></div>
    </form>
   </div>
   <script>click_dialogue($('#btn_delete'), $('#dia_delete'));</script>
  {% endif %}
 </div>
{% endblock %}

{% block content %}
 {% if auth_required %}
  <script>
   $(function() {
       showDialog('#dia_password');
       $('#password_input').select();
   });
  </script>
 {% else %}
  {{ body }}
 {% endif %}
 
 <script>
 var exp = {{ exp_js }};
 $(window).resize(function() {
    var s = $(window).width() / 1000;
    $.map(exp.apps, function(a, i) {
        var e = $('#h_' + i);
        e.css({ left : a.position[0] * s, top : a.position[1] * s,
            width : a.dimensions[0] * s, height : a.dimensions[1] * s,
            'font-size' : a.scale * s + 'em', opacity : a.opacity });
        if(a.angle) e.rotate(a.angle);
    });
 });
 $(window).resize();
 </script>
{% endblock %}
