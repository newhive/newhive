{% extends "main.html" %}

{% block meta %}
 <meta property="og:title" content='{{ title |e }}' />
 <meta property="og:type" content="article" />
 <meta property="og:image" content='{{ exp.thumb|default('http://thenewhive.com/lib/skin/1/thumb_0.png') | e }}' />
 <meta property="fb:admins" content="1007003" />
{% endblock %}
{% block head %}
 <style>
  #exp_owner { background-color : {{ colors['selected'] }}; margin : 5px 0 5px; padding : 1px 5px; display : inline-block; }
  #datetime { font-size : .7em; color : {{ colors[12] }}; line-height : .5em; }
  #info { display : inline-block; text-align : right; margin-right : 10px; vertical-align : top; }
 </style>
 <script src='{{ assets_env['expression.js'].urls()[0] }}'></script>
 <script type='text/javascript'>
     var expr_id = '{{exp.id}}';
     var comment_count = {{exp.comment_count}};
 </script>
{% endblock %}

{% block body %}
 <input type='hidden' name='expr_id' id='expr_id' value='{{ exp.id }}'>
 {% if pagethrough and pagethrough.prev %}
   <div id="pagethrough_prev" class='nav pagethrough'><a href='{{pagethrough.prev}}' class='pagethrough-prev' ></a></div>
 {% endif %}
 {% if pagethrough and pagethrough.next %}
   <div id="pagethrough_next" class='nav pagethrough'><a href='{{pagethrough.next}}' class='pagethrough-next' ></a></div>
 {% endif %}
 <div class='nav' style='right : {{ '10' if user.logged_in else '197' }}px; top : 0px;'>
  {% if not user_is_owner %}
   {{ listen_button(active=owner.id in user.starred_items, title='Listen to ' + owner['name'], active_title='Stop listening') if user.logged_in }}
   <div id='info' class='medbold' style='text-align : right'>
     <div id='exp_owner'><a title="{{owner.name}}'s profile" href='{{ owner_url }}'>{{ owner['name'] }}</a></div>
    <div id='datetime' style="whitespace: nowrap;">{{ mtime }}</div>
   </div>
  {% endif %}

  {{ share_button(exp.share_count) }}
  {{ star_button(exp.star_count, exp.id in user.starred_items, user.logged_in) }} 
  {{ discussion_button(exp.comment_count) }}
  {% if user.logged_in %}
  {{ create_button(create) }}  
  {% endif %}
 
  {% if user_is_owner %}
   <a href='{{ edit }}'><img id='btn_edit' src='/lib/skin/1/edit.png' class='hoverable nav_icon' title='edit'></a>
   {% if path %}
    <img id='btn_delete' src='/lib/skin/1/delete_page.png' class='hoverable nav_icon' title='delete'>
    <div id='dia_delete' class='menu medbold' style='padding : 10px; width : 13em;'>
     Are you sure you want
     to delete this page?
     <br>
     <form method='POST' action='{{ secure_server }}'>
      <input type='hidden' name='action' value='expr_delete'>
      <input type='hidden' name='id' value='{{ exp.id }}'>
      <div style='text-align : right'><input type='submit' value='Yes' class='btn black rounded medbold'></div>
     </form>
    </div>
    <script>hover_menu($('#btn_delete'), $('#dia_delete'), { hover : false });</script>
   {% endif %}
   {% if owner.flags.expr_new %}<script>$(function() {
    updateShareUrls('#dia_share', window.location);  
    showDialog('#dia_share', { minimize_to : '#btn_share' } );
   })</script>{% endif %}
  {% endif %}
  {% for collection in [{'data': starrers, 'type': 'starrers', 'id': 'starrers'}, {'data': listeners, 'type': 'listeners', 'id': 'listeners'}] %}
  {% include "dialogs/starrers.html" %}
  {% endfor %}
  {# include "dialogs/listeners.html" #}
 </div>
 {% include 'expr_background.html' %}
{% endblock %}

{% block content %}
 {% if auth_required %}
  <script>
   $(function() {
       showDialog('#dia_password');
       $('#password_input').select();
   });
  </script>
 {% else %}
  {{ body }}
 {% endif %}
{% endblock %}

{% block footer_scripts %}
<script>
  $(function(){
    pagethrough_btns = $('.pagethrough');
    pagethrough_btns.css('top', ($(window).height() - pagethrough_btns.height())/2)
    var hover_width = 150;
    $(window).mousemove(function(event){
      if ($(window).width() - event.pageX < hover_width) {
        $('#pagethrough_next').show();
      } else { $('#pagethrough_next').hide(); }
      if (event.pageX < hover_width) {
        $('#pagethrough_prev').show();
      } else { $('#pagethrough_prev').hide(); }
    });
  });
</script>
{% endblock footer_scripts %}
