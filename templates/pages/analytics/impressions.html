{% extends "base.html" %}

{% block head %}
    {% for item in assets_env["admin.js"].urls_with_expiry() %}
      <script src='{{ item }}'></script>
    {% endfor %}
{{ super() }}
<script>
  var data = {{data | json}};
  var edges = {{edges | json}};
  var chart;
  $(function(){
    chart = d3.select("#chart").append("svg").attr("class", "chart").attr("width", 1000).attr("height", 400);
    chart.opts = {width: 960, height: 360, paddingTop: 10, paddingLeft: 40};
    var y = chart.y = d3.scale.linear().domain([0, d3.max(data)]).range([0, chart.opts.height]);
    var x = chart.x = function(d,i) { return Math.floor(chart.opts.width/data.length) * i + chart.opts.paddingLeft + 10 };
    x.rangeBand = function() { return chart.opts.width/data.length };

    chart.selectAll("line")
      .data(y.ticks(10)).enter().append("line")
      .attr("x2", chart.opts.paddingLeft).attr("x1", 1300)
      .attr("y2", function(d){ return chart.opts.height + chart.opts.paddingTop - y(d)})
      .attr("y1", function(d){ return chart.opts.height + chart.opts.paddingTop - y(d)})
      .style("stroke", "#ccc");

    chart.selectAll(".y-label")
      .data(y.ticks(10)).enter().append("text").attr("class", "y-label")
      .attr("x", chart.opts.paddingLeft).attr("y", function(d){ return chart.opts.height + chart.opts.paddingTop - y(d) })
      .attr("dx", -3).attr("dy", ".35em").attr("text-anchor", "end").style("font-size", "12px")
      .text(String);

    chart.selectAll(".x-label")
      .data(data).enter().append("text").attr("class", "y-label")
      .attr("x", function(d,i){ return x(d,i) + x.rangeBand()/2} ).attr("y", chart.opts.height + chart.opts.paddingTop + 10)
      .attr("dx", 0).attr("text-anchor", "middle").style("font-size", "10px").style("color", "#888")
      .text(function(d,i){return edges[i] + "-" + edges[i+1] });

    chart.selectAll("rect")
      .data(data).enter().append("rect")
      .attr("x", x).attr("width", x.rangeBand() - 1).attr("height", y)
      .attr("y", function(d) { return chart.opts.height + chart.opts.paddingTop - y(d) })
      .style("fill", "steelblue");

  });
</script>
<style type="text/css">
    path {
            stroke: steelblue;
            stroke-width: 2;
            fill: none;
    }
     
    line {
            stroke: black;
    }
     
    text {
            font-family: Arial;
            font-size: 9pt;
    }
</style>
{% endblock %}
{% block main %}
    <div id="chart"></div>
{% endblock %}
