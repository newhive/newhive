{% extends "main.html" %}

{% if 'home' %}
  {% block meta %}
  <meta name="description" content="{{description + " - " if description}}We believe that your life is a blank canvas + you decide what goes on it.
NewHive is your radically simple, DIY self publishing tool." />
    <meta property="og:image" content='{{ 'skin/1/logo_medium.png'|asset_url }}' />
  {% endblock meta %}
{% endif %}

{% block head %}
  {{ super() }}
  <script>
    {% if profile and user_is_owner %}
      $(function(){
          var hoverin = function(){ $('#profile_thumb').append('<div class="message">Change Picture</div>'); };
          var hoverout = function(){ $('#profile_thumb .message').remove(); };
          $('#profile_thumb img').hover(hoverin, hoverout);
      });
    {% endif %}
    {% if home and not user.logged_in %}
      function homepage_header() {
          var header = $('#homepage_header')
          if (header.length > 0)
              $('#homepage_header').height( parseInt(header.find('.background').css('height')) );
      }
      $(function(){
        var dia;
        $('.signup_button').click(function() {
          dia = showDialog('#dia_signup');
          $(this).addClass('open');
          $('input[name=forward]').val(window.location);
        });
        $(window).resize(homepage_header);
        homepage_header();
        $('.fathead').width($(window).width()-50);
      });
    {% endif %}
    {% if owner %}var owner_id = {{ owner.id | json }};{% endif %}
  </script>
  <script>
  curl(['card_renderer','browser/client_ui'], function(cardRenderer, clientUI) {
      // Bootstrap community page with first set of cards.
      cardRenderer().renderCards({{ cards|json }});
      clientUI().wrapLinks();
  });
  </script>
{% endblock %}

{% block left_column %}
<div><a data-load-route="/api/&lt;username&gt;/profile/network" data-username="{{ user.name }}" href="/{{ user.name }}/profile/network">network</a></div>
<div><a data-load-route="/api/&lt;username&gt;/profile/expressions/public" data-username="{{ user.name }}" href="/{{ user.name }}/profile/expressions/public">my public expressions</a></div>
{% endblock left_column %}
    
{% block right_column %}
  {% if require_login and not user.logged_in %}
    <script>$(function() { require_login('restricted_page'); });</script>
  {% else %}
    <div id='feed'>
      <div class="feed-content" style='position:relative'>{{ content }}</div>
    </div>
  {% endif %}
{% endblock right_column %}

{% block footer_scripts %}
  {{ super () }}
  <script>
     paging_args = {{ args | json }};
     var load_page = null;
     var next_page = true;
     var c = 0;
     $(window).scroll(function() {
         if(($(window).scrollTop() > $('#content').height() - $(window).height() * 2) && !load_page && next_page) {
             var next = $('.next_page').attr('href');
             if(!next) {
                 //next_page = false;
                 return;
             }
             load_page = $.get(next, {}, function(data) {
                 console.log('loading');
                 load_page = null;
                 $('.next_page').remove();
                 $('#feed').append(data);
                 fix_borders('#feed .item');
             });
         }
     });

     function fb_listen_or_connect() {
         if(fb_logged_in) loadDialogPost('facebook_listen');
         else showDialog('#dia_facebook_connect');
     }

     var current_tag = {{ user_tag|json }};
     function folder_add() {
         var tag = prompt('New Folder');
         $('#action_input').val('user_tag_add');
         $('#value_input').val(tag);
         $('#upload_form').submit();
         $('#upload_target').load(function() { window.location = window.location });
     }
     function folder_remove() {
         $('#action_input').val('user_tag_remove');
         $('#value_input').val(current_tag);
         $('#upload_form').submit();
         $('#upload_target').load(function() { window.location = '{{ user.url }}' });
     }
     $(function(){ 
       fix_borders('#feed .item');
       $(window).resize(function(){fix_borders('#feed .item');});
     });
  </script>
{% endblock %}
