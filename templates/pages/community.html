{% extends "main.html" %}

{% if 'home' %}
  {% block meta %}
    <meta name="description" content="{{ui.intro_paragraph}}" />
    <meta property="og:image" content='http://thenewhive.com/lib/skin/1/logo_medium.png' />
  {% endblock meta %}
{% endif %}

{% block head %}
  {{ super() }}
  {% if user_is_owner %}
    <script>
      $(function(){
          var hoverin = function(){ $('#profile_thumb').append('<div class="message">Change Picture</div>'); };
          var hoverout = function(){ $('#profile_thumb .message').remove(); };
          $('#profile_thumb img').hover(hoverin, hoverout);
      });
    </script>
  {% endif %}
  {% if home and not user.logged_in %}
    <script>
      function homepage_header() {
          var header = $('#homepage_header')
          if (header.length > 0)
              $('#homepage_header').height( parseInt(header.find('.background').css('height')) );
      }
      $(function(){
        var dia;
        $('.signup_button').click(function() {
          dia = showDialog('#dia_signup');
          $(this).addClass('open');
          $('input[name=forward]').val(window.location);
        });
        $(window).resize(homepage_header);
        homepage_header();
        $('.fathead').width($(window).width()-50);
      });
    </script>
  {% endif %}
{% endblock %}

{% block body_classes %}{{ super() }}{{ ' home' if home }}{{ ' profile' if profile }}{% endblock %}

{% block nav_right_left %}
  {% if profile and user_is_owner %}
    <div class='nav_icon text hoverable medbold center pad' onclick="" title="Help with your profile" style='margin-right : 8px;' id='btn_help'>?</div>
    <script>
      $('#btn_help').click(function() { exprDialog('{{ site_pages['profile-help'] }}', { minimize_to : $('#btn_help') } ) });
      {% if show_help %}$('#btn_help').click();{% endif %}
    </script>
  {% endif %}
{% endblock %}

{% macro top_tab(p, label) %}
  {% set current = True if p == path %}
  <div class='tab_label {{ 'current' if current else 'hoverable' }}'
    >{% if current %}{{ label }}{% else %}<a href='/{{ p }}'>{{ label }}</a>{% endif %}</div>
{%- endmacro %}

{% block header %}
  {% if home %}
    {% if not user.logged_in %}
      <div id="homepage_header" style='width:100%; height:255px;'>
        <div class="happ background" style="left:0px; top:0px; width:1000px; height: 245px; {#background-color: {{ colors['tan'] }};#} z-index: 3;"></div>
        <div class="happ" style="left: 48px; top: 32px; width: 700px; height: 56px; z-index: 3; font-size: 3.3em; font-weight: normal; font-family: Lobster;" data-scale="3.3">
          Express Your<span style="margin:-0.04em">self</span>
        </div>
        <div class='happ' style='width:510px; height: 44px; left:48px; top: 102px; z-index: 3; font-size: 0.75em;' data-scale="0.75">
          {{ ui.intro_paragraph }}
        </div>
        <div class='happ rounded signup_button' style='width:74px; white-space: nowrap; padding: 3px 5px 10px 5px; height: 21px; left:48px; top: 190px; z-index: 3; font-size: 1.2em;' data-scale="1.2">
          <span style="font-family: Museo;"><a href="" onclick="return false;">Sign up</a></span>
        </div>
        <div class='happ' style='left: 150px; top: 197px; width: 400px; z-index: 3;'>
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://thenewhive.com" data-text="The New Hive is the easiest way to express yourself online. #expression" data-count="horizontal" data-via="newhive">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
          <iframe src="//www.facebook.com/plugins/like.php?href=http%3A%2F%2Fthenewhive.com&amp;send=false&amp;layout=button_count&amp;width=450&amp;show_faces=true&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:180px; height:20px;" allowTransparency="true"></iframe>
          <div class="fb-facepile" data-max-rows="1" data-width="300"></div>
        </div>
        <div id="h_2" class="happ" style="left: 585px; top: 20px; width: 365.802px; height: 206.727px; z-index:3;">
          <iframe src="http://player.vimeo.com/video/18836819?title=0&amp;byline=0&amp;portrait=0" width="100%" height="100%" frameborder="0" webkitAllowFullScreen allowFullScreen></iframe>
        </div>
      </div>
    {% endif %}
  {% endif %}
  {% if profile %}
    <div id='profile_header'>
      <div id='profile_thumb'>
        {% if user_is_owner %}
          <a href="#" onclick="profile_thumb_choose();" alt="Choose Picture">
        {% endif %}
        {% if owner.get_thumb() %}
          <img src='{{ owner.get_thumb() }}' alt="{{ owner.fullname }}"/>
        {% elif user_is_owner %}
          <div class='placeholder rounded'>Click Here to<br/>Upload A Profile Image</div>
        {% endif %}
        {% if user_is_owner %}
          </a>
        {% endif %}
      </div>
      <span class='fathead'>{% if owner.has_homepage %}<a href='/'>{% endif %}{{ owner.fullname }}{% if owner.has_homepage %}</a>{% endif %}{{ ': ' + tag.name if tag and tag.show_name != False }}</span>
    </div>
  {% endif %}
  <div id='card_header'>
    <div class='title'>
      {% if network and cards|length < 10 %}
        <img src='/lib/skin/1/people_small.png' style='float: left; vertical-align: middle; margin-right: 10px;'>
        <span class='info'>To listen to someone, click the person icon next to their name.<br>
        Activity of the people you're listening to will appear on this page.</span>
      {% elif search %}
        <span class='head'>Results for: {{ q.q|e }}</span>
      {% elif tag_page %}
        <span class='head'>#{{ tag|e }}</span>
      {% endif %}
    </div>
    <div id='top_tabs'>
      {% if path1 == 'home/expressions' %}
          {{ top_tab('home/expressions', 'Featured') }}
        | {{ top_tab('home/expressions/all', 'All') }}
      {% endif %}

      {% if (path1 == 'profile/expressions') and user_is_owner %}
        {{ top_tab('profile/expressions', 'All') }}
        | {{ top_tab('profile/expressions/public', 'Public') }}
        | {{ top_tab('profile/expressions/private', 'Private') }}
      {% elif path1 == 'profile/activity' %}
        {{ top_tab('profile/activity', 'My activity') }}
        | {{ top_tab('profile/activity/network', 'Network') }}
      {% elif path1 == 'profile/listening' %}
        {{ top_tab('profile/listening', 'I\'m listening to') }}
        | {{ top_tab('profile/listening/listeners', 'Listening to me') }}
      {% endif %}
    </div>
  </div>
{% endblock header %}

{% macro left_tab(p1, label) %}
  {% set current = True if p1 == path1 %}
  <div class='tab_label {{ 'current' if current else 'hoverable' }}'
    >{% if current %}{{ label }}{% else %}<a href='/{{ p1 }}'>{{ label }}</a>{% endif %}</div>
{%- endmacro %}

{% block left_column %}
  <div id='left_tabs' class='{{ 'home' if home else 'profile' }}'>
    {% if home %}
      {{ left_tab('home/expressions', 'Expressions') }}
      {% if user.logged_in %}{{ left_tab('home/network', 'Network') }}{% endif %}
      {{ left_tab('home/people', 'People') }}
      {{ left_tab('home/about', 'About') }}
    {% endif %}
    {% if profile %}
      {{ left_tab('profile/expressions', 'Expressions') }}
      {{ left_tab('profile/activity', '<img src="/lib/skin/1/activity_tab.png">Activity') }}
      {{ left_tab('profile/listening', '<img src="/lib/skin/1/listening_tab.png">Listening') }}
    {% endif %}
  </div>
  <div id="user_tags">
    {% for t in tags %}<div class='tag_label hoverable user {#{ 'current' if t.name == tag.name }#} tag_{{loop.index0 | mod(16) }}'>
      <a href='{{ t.url |e }}' value='{{ t.name|e }}'>{{ t.name }}</a>
    </div>{% endfor %}
  </div>
{% endblock left_column %}

{% block right_column %}
  <div id='feed'>
    {% if network and cards|length < 10 %}
      <div class='prompt'><img src='/lib/skin/1/prompt_allies.png'      class='hoverable'><div>Click the tags on the left to find people creating expressions about your interests.</div></div>
      <div class='prompt'><img src='/lib/skin/1/prompt_expressions.png' class='hoverable'><div>Click here to connect to Facebook and follow / invite friends.</div></div>
      <div class='prompt'><img src='/lib/skin/1/prompt_interests.png'   class='hoverable'><div>Click here or "Expressions" on the left to explore featured expressions and find people to listen to.</div></div>
    {% endif %}
    {% include 'page_parts/cards.html' %}
  </div>
{% endblock right_column %}

{% block footer_scripts %}
  {{ super () }}
  <script>
    //var load_page = null;
    //var next_page = 1;
    //var pages = {{ pages }};
    //$(window).scroll(function() {
    //    if(($(window).scrollTop() > $(document).height() - $(window).height() * 2) && !load_page && next_page < pages) {
    //        load_page = $.get('', { partial : true, page : next_page }, function(data) {
    //            load_page = null;
    //            next_page ++;
    //            $('#feed').append(data);
    //            fix_borders('#feed .item');
    //        });
    //    }
    //});

    $(function(){ 
      fix_borders('#feed .item');
      $(window).resize(function(){fix_borders('#feed .item');});
    });
  </script>
{% endblock %}
