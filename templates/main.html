{% extends "base.html" %}
{% from "macros/main.html" import star_button, share_button, create_button, discussion_button, listen_button, starrers_menu, context_to_string %} 

{% block head %}
<script>
  var fb_logged_in = false;
  window.fbAsyncInit = function() {
    FB.init({
      appId      : {{facebook_app_id}}, // App ID
      //channelUrl : '//WWW.YOUR_DOMAIN.COM/channel.html', // Channel File
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });
    FB.getLoginStatus(function(data){
        if (data.authResponse && data.authResponse.userID == fb_id) {
            fb_logged_in = true;
        }
    });
    // Additional initialization code here
  };

  // Load the SDK Asynchronously
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));
</script>
{% endblock head %}
{% block body_classes %}{{ super() }} main {% endblock body_classes%}

{% block main %}
  <div id="nav">
    {% block nav %}
      {% include "page_parts/nav.html" %}
    {% endblock nav %}
  </div>
  {% block body %}
  {% endblock body %}
  <div id="fb-root" style="position: fixed; top: 0; left: 0;"></div>
  <div id='content'>
    {% block content %}
      <div id="header">
        {% block header %}{% endblock %}
      </div>
      <div id="primary_content">
        <div id="left_column">
          {% block left_column %}{% endblock %}
        </div>
        <div id="right_column">
          {% block right_column %}{% endblock %}
        </div>
      </div>
    {% endblock content %}
  </div>

  {% if user.logged_in %}
    <img id='feedback_btn' style='position : fixed; bottom:0; right:0' src='/lib/skin/1/feedback_btn.png' class='top hoverable tip_none' title='Send feedback'>
    <script>
      $('#feedback_btn').click(function() {
        new_window('{{ secure_server }}feedback?url=' + window.location, 470, 400);
      });
    </script>
  {% endif%}
  
  <div id='dialogs'>
    {% block dialogs %}
      {% if user.logged_in %}
        {% include 'dialogs/referral.html' %}
        {% include 'dialogs/facebook_connect.html' %}
      {% else %}
          {% include 'dialogs/sign_in_or_join.html' %}
      {% endif %}
      {% include 'dialogs/password.html' %}
      {% include 'dialogs/password_recovery.html' %}
      {% include 'dialogs/signup.html' %}
      {% include 'dialogs/ie_warning.html' %}
      {% include 'dialogs/share.html' %}
      {% if dialog_to_show == '#dia_fb_account_duplicate' %}
          {% include 'dialogs/fb_account_duplicate.html' %}
      {% endif %}
      {% if new_fb_connect or debug %}
          {% include 'dialogs/fb_connect_landing.html' %}
      {% endif %}
    {% endblock dialogs %}
  </div>
{% endblock main %}
