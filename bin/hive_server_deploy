#! /bin/sh
HERE=$(pwd)
export PATH="$PATH:$HERE/node_modules/.bin"

#sudo chown www-data:dev -R .
#sudo chmod g+rwX -R .

if [ "$1" = "clean" ]; then
    echo "cleaning..."
    sudo rm -rf libsrc/.cram libsrc/.webassets-cache
    find -name '*.pyc'|xargs rm
fi

# cram sucks and tries to open unreasonable numbers of files
ulimit -S -n 4000 # hard limit default on Ubuntu seems to 4096
bin/build_assets.py

sudo service apache2 restart
