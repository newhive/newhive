#!/bin/sh
BACKUP_DIR=/mnt/scratch/backup/
DB_HOST='set-545083bed81b4a4cfc00108a/candidate.42.mongolayer.com:10088,candidate.43.mongolayer.com:10161'
DB_USER='live'
DB_PASSWORD='denjiafijUt1'
DB='live-newhive5'

cd $BACKUP_DIR
date=$(date +%Y-%m-%d)
rm *.gz # clean up old backup
rm -rf tmp/*
mongodump -h $DB_HOST -d $DB -u $DB_USER -p $DB_PASSWORD -o tmp --excludeCollectionsWithPrefix=system
#mongorestore --drop -d test --dir tmp/hive
fname=${date}_live-db-dump.tar.gz
tar -zcf $fname tmp/$DB
s3cmd put $fname s3://backup-thenewhive/$fname

#TODO: create daily, weekly, monthly rotating backups.
